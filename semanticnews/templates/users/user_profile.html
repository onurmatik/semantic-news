{% extends "base.html" %}

{% load static i18n humanize %}

{% block title %}{{ block.super }}{% endblock %}


{% block content %}

    <div class="container">

        <h1 class="fs-3 mb-3 pb-3 border-bottom">
            {{ profile }}
        </h1>

        <div class="row">

            <div class="col-12 col-md-8">

                <div id="user-topics-container">

                    {% for topic in topics %}

                        {% include "topics/topics_list_item.html" %}

                    {% empty %}

                        <span class="text-secondary">{% trans "No topic created yet." %}</span>

                    {% endfor %}

                </div>

            </div>

            <div class="col-12 col-md-4">

                <div class="card">

                    <div class="card-body">

                        <h6 class="card-title">{% blocktrans %}Added by {{ profile }}{% endblocktrans %}</h6>

                        {% for content in topic_content %}

                            {% with topic=content.topicarticle.topic %}

                                {% include "topics/topic_content_item.html" %}

                            {% endwith %}

                            {% if not forloop.last %}
                                <hr>
                            {% endif %}

                        {% empty %}

                            <span class="text-secondary">{% trans "No content added yet." %}</span>

                        {% endfor %}

                    </div>

                </div>

            </div>

        </div>

    </div>

{% endblock %}


{% block extra_js %}

{% include "bookmarks_js.html" %}

<script>
    document.addEventListener('click', async e => {
        const btn = e.target.closest('.delete-topic-btn');
        if (!btn) return;

        e.preventDefault();
        disposeTooltip(btn);

        if (!confirm("{% trans "Are you sure you want to delete this draft?" %}")) return;

        const url = btn.dataset.url;
        const resp = await fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'X-Requested-With': 'XMLHttpRequest',
            },
        });

        const data = await resp.json();
        if (resp.ok) {
            appendToast('{% trans "Success!" %}', data.message, 'success');

            // Remove the topic card from the DOM:
            const card = document.querySelector(
                `[data-topic-uuid="${data.uuid}"]`
            );
            if (card) card.remove();

            // Optionally, if the list is now empty, show a "No topics" message:
            const container = document.querySelector('#user-topics-container');
            if (container && container.children.length === 0) {
                container.innerHTML = '<span class="text-secondary">{% trans "No topic created yet." %}</span>';
            }
        } else {
            appendToast('{% trans "Error!" %}', data.error, 'danger');
        }
        showToasts();
    });
</script>

{% endblock %}
