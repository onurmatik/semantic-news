{% load i18n %}

<div class="event-item mb-3 position-relative pe-4"
     data-event-uuid="{{ event.uuid }}"
     data-categories="{% for category in event.categories.all %}{% if not forloop.first %} {% endif %}{{ category.name|slugify }}{% endfor %}"
     data-domains="{% for source in event.sources.all %}{% if not forloop.first %} {% endif %}{{ source.domain }}{% endfor %}">
    <p class="text-secondary small mb-0">
        {{ event.date|date:"M d, Y" }}
        {% for category in event.categories.all %}
            &middot; {{ category }}
        {% endfor %}
    </p>
    <h2 class="fs-6">
        <a href="{{ event.get_absolute_url }}">{{ event.title }}</a>
    </h2>
    <p>
        {% for source in event.sources.all %}
            <a class="small text-secondary" target="_blank" href="{{ source }}">{{ source.domain }}</a>
            {% if not forloop.last %}&middot;{% endif %}
        {%  endfor %}
    </p>

    {# Add button (only when requested by parent) #}
    {% if request.user.is_authenticated and show_add|default:False %}
        <div class="dropdown d-inline">
            <button class="btn btn-sm btn-outline-primary dropdown-toggle"
                    type="button" data-bs-toggle="dropdown" aria-expanded="false">
                {% trans "Add" %}
            </button>
            <ul class="dropdown-menu">
                {# Quick-add to the current topic if provided #}
                {% if topic %}
                    {% if event not in topic.active_events %}
                        <li>
                            <a class="dropdown-item small add-to-topic"
                               href="#"
                               data-topic-uuid="{{ topic.uuid }}"
                               data-event-uuid="{{ event.uuid }}">
                                {% trans "This topic" %}
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                    {% endif %}
                {% endif %}

                {# Userâ€™s other topics #}
                {% if user_topics %}
                    <li><h6 class="dropdown-header">{% trans "Your topics" %}</h6></li>
                    {% for t in user_topics %}
                        <li>
                            <a class="dropdown-item small add-to-topic"
                               href="#"
                               data-topic-uuid="{{ t.uuid }}"
                               data-event-uuid="{{ event.uuid }}">
                                {{ t.title }}
                            </a>
                        </li>
                    {% endfor %}
                    <li><hr class="dropdown-divider"></li>
                {% endif %}

                <li>
                    <a class="dropdown-item small"
                       href="#"
                       data-topic-create
                       data-topic-create-default-title="{{ event.title|default_if_none:''|escape }}"
                       data-topic-create-event-uuid="{{ event.uuid }}">
                        {% trans "Create new topic" %}
                    </a>
                </li>
            </ul>
        </div>
    {% endif %}

    {# Remove button (only when requested by parent) #}
    {% if show_remove|default:False and request.user.is_authenticated %}
        <button type="button"
                class="btn btn-sm btn-outline-danger position-absolute top-0 end-0 remove-event-btn"
                aria-label="{% trans 'Delete event' %}">
            <i class="bi bi-trash"></i>
        </button>
    {% endif %}
</div>
