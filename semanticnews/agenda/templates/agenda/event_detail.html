{% extends "base.html" %}

{% load static i18n humanize markdown_extras %}

{% block title %}{{ event.title }}{% endblock %}


{% block content %}

<div class="container">

    <div class="row">

        <p class="text-muted small mb-0">{{ event.date|date:"M d, Y" }}</p>
        <h1 class="fs-3">{{ event.title }}</h1>

    </div>


    <div class="row">

        <div class="col-12 col-md-8">

            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="fs-5 mb-0">{% trans "Timeline" %}</h2>
                {% if user.is_authenticated %}
                <button id="suggestEventsBtn" data-event-title="{{ event.title }}" class="btn btn-sm btn-outline-secondary" title="{% trans 'Add events' %}">
                    <i class="bi bi-plus-lg"></i>
                </button>
                {% endif %}
            </div>

            {% if categories or domains %}
            <div class="d-flex align-items-center mb-3">
                {% if categories %}
                <div class="me-2">
                    {% for category in categories %}
                    <a href="#" class="btn btn-sm btn-outline-secondary me-1 category-filter" data-category="{{ category.name|slugify }}">{{ category.name }}</a>
                    {% endfor %}
                </div>
                {% endif %}
                {% if domains %}
                <div class="dropdown ms-auto">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="domainDropdown" data-bs-toggle="dropdown" aria-expanded="false" data-default-label="{% trans 'All domains' %}">{% trans "All domains" %}</button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="domainDropdown">
                        <li><a class="dropdown-item domain-option active" href="#" data-domain="">{% trans "All domains" %}</a></li>
                        {% for domain in domains %}
                        <li><a class="dropdown-item domain-option" href="#" data-domain="{{ domain }}">{{ domain }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if domains %}
            <div class="mb-3">
                <select id="domainFilter" class="form-select form-select-sm w-auto">
                    <option value="">{% trans "All domains" %}</option>
                    {% for domain in domains %}
                        <option value="{{ domain }}">{{ domain }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            {% for sim_event in similar_events %}
                {% include "agenda/event_list_item.html" with event=sim_event %}
            {% empty %}
                <p>{% trans "No related events" %}</p>
            {% endfor %}

        </div>

        <div class="col-12 col-md-4">

            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="fs-5 mb-0">{% trans "Topics" %}</h2>
                {% if user.is_authenticated %}
                <button data-event-title="{{ event.title }}" class="btn btn-sm btn-outline-secondary add-topic-btn" title="{% trans 'Add topic' %}">
                    <i class="bi bi-plus-lg"></i>
                </button>
                {% endif %}
            </div>

            <ul class="list-unstyled">
                {% for topic in topics %}
                    <li><a href="{{ topic.get_absolute_url }}">{{ topic.title }}</a></li>
                {% empty %}
                    <li class="text-muted">{% trans "No topics" %}</li>
                {% endfor %}
            </ul>

        </div>
    </div>
</div>

{% include "topics/create_topic_modal.html" %}
{% if user.is_authenticated %}
{% include "agenda/event_modal.html" %}
{% endif %}

{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {% if user.is_authenticated %}
    {{ exclude_events|json_script:"exclude-events" }}
    <script src="{% static 'agenda/event_modal.js' %}"></script>
    {% endif %}
    <script src="{% static 'agenda/category_filter.js' %}"></script>
    <script src="{% static 'agenda/domain_filter.js' %}"></script>
    {% include "topics/create_topic_js.html" %}
{% endblock %}
