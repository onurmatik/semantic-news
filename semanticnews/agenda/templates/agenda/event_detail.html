{% extends "base.html" %}

{% load static i18n humanize markdown_extras %}

{% block title %}{{ event.title }}{% endblock %}


{% block content %}

<div class="container">

    <div class="row">

        <p class="text-muted small mb-0">{{ event.date|date:"M d, Y" }}</p>
        <h1 class="fs-3">{{ event.title }}</h1>

    </div>


    <div class="row">

        <div class="col-12 col-md-8">

            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="fs-5 mb-0">{% trans "Related events" %}</h2>
                <button id="suggestEventsBtn" data-event-title="{{ event.title }}" class="btn btn-sm btn-outline-secondary" title="{% trans 'Add events' %}">
                    <i class="bi bi-plus-lg"></i>
                </button>
            </div>

            {% for sim_event in similar_events %}
                {% include "agenda/event_list_item.html" with event=sim_event %}
            {% empty %}
                <p>{% trans "No related events" %}</p>
            {% endfor %}

        </div>

        <div class="col-12 col-md-4">

            <h2 class="fs-5">{% trans "Topics" %}</h2>
            <ul class="list-unstyled">
                {% for topic in event.topics.all %}
                    <li><a href="{{ topic.get_absolute_url }}">{{ topic.title }}</a></li>
                {% empty %}
                    <li class="text-muted">{% trans "No topics" %}</li>
                {% endfor %}
            </ul>

        </div>
    </div>
</div>

<div class="modal fade" id="suggestEventsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Fetch more related events" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'Close' %}"></button>
            </div>
            <div class="modal-body">
                <form id="suggestEventsForm" class="mb-3">
                    <div class="mb-3">
                        <label for="suggestRelatedEvent" class="form-label">{% trans "Related event" %}</label>
                        <input type="text" class="form-control" id="suggestRelatedEvent" value="{{ event.title }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="suggestLocality" class="form-label">{% trans "Locality" %}</label>
                        <select class="form-select" id="suggestLocality">
                            <option value="">{% trans "Global" %}</option>
                            {% for locality in localities %}
                                <option value="{{ locality.name }}">{{ locality.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="suggestStartDate" class="form-label">{% trans "Start date" %}</label>
                        <input type="date" class="form-control" id="suggestStartDate">
                    </div>
                    <div class="mb-3">
                        <label for="suggestEndDate" class="form-label">{% trans "End date" %}</label>
                        <input type="date" class="form-control" id="suggestEndDate">
                    </div>
                    <button type="submit" class="btn btn-primary">{% trans "Fetch suggestions" %}</button>
                </form>
                <div id="suggestedEventsList" class="d-none">
                    <p>{% trans "Loading suggestions..." %}</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="publishSelectedEventsBtn">{% trans "Publish selected" %}</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {{ exclude_events|json_script:"exclude-events" }}
    <script src="{% static 'agenda/event_suggestions.js' %}"></script>
{% endblock %}
