{% load markdown_extras %}

<div class="related-topic-item position-relative mb-4 pb-4 border-bottom" data-topic-uuid="{{ topic.uuid }}">
    <h3 class="fs-6 mb-2">
        <a href="{{ topic.get_absolute_url }}" class="text-decoration-none text-body">{{ topic.display_title }}</a>
    </h3>
    <a href="{{ topic.get_absolute_url }}" class="stretched-link" aria-hidden="true"></a>

    {% with hero=topic.thumbnail %}
        {% if hero %}
            <img src="{{ hero.url }}" alt="{{ topic.display_title }}" class="img-fluid rounded mb-2">
        {% else %}
            {% with first_visualization=topic.active_data_visualizations.all|first %}
                {% if first_visualization %}
                    <div
                        class="chart-container rounded border mb-2 bg-body"
                        data-visualization-preview="{{ first_visualization.id }}"
                    >
                        <canvas
                            id="dataVisualizationChartSidebar{{ first_visualization.id }}"
                            class="data-visualization-chart w-100"
                            data-chart-type="{{ first_visualization.chart_type }}"
                            data-chart="{{ first_visualization.chart_data|jsonify }}"
                        ></canvas>
                    </div>
                {% endif %}
            {% endwith %}
        {% endif %}
    {% endwith %}

    {% with latest_recap=topic.active_recaps.last %}
        {% if latest_recap %}
            <div class="small text-body">{{ latest_recap.recap|markdownify }}</div>
        {% elif topic.prefetched_recaps %}
            {% with fallback=topic.prefetched_recaps|first %}
                {% if fallback %}
                    <div class="small text-body">{{ fallback.recap|markdownify }}</div>
                {% endif %}
            {% endwith %}
        {% endif %}
    {% endwith %}
</div>
