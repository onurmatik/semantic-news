{% load i18n markdown_extras %}

<div class="position-relative mb-3 pb-3 border-bottom" data-topic-uuid="{{ topic.uuid }}">

    <h1 class="d-flex fs-4 w-100">

        <a href="{{ topic.get_absolute_url }}"
           class="text-body text-decoration-none">{{ topic.title }}
        </a>

        <small class="d-flex fs-5 ms-auto mt-1">

            <a href="#" data-bs-toggle="tooltip" data-bs-title="{% trans "Bookmark this topic" %}"
               class="text-info-emphasis bi bi-bookmark"
            ></a>

            <a href="#" data-bs-toggle="tooltip" data-bs-title="{% trans "Copy link" %}"
               class="text-info-emphasis bi bi-link copy-link ms-1"
               data-url="{{ topic.get_absolute_url }}"></a>

        </small>

    </h1>

    <p class="me-auto mb-3 text-secondary small">

        {% url 'user_profile' username=topic.created_by.username as user_topics_url %}

        {% blocktrans with created_date=topic.created_at|date created_by=topic.created_by.profile modified_ago=topic.updated_at|timesince %}Created on {{ created_date }} by <a class="text-info-emphasis" href="{{ user_topics_url }}">{{ created_by }}</a>; updated {{ modified_ago }} ago.{% endblocktrans %}
        {% with item_count=topic.contents.count contributor_count=topic.contributors.count %}
            <nobr>
                {% if item_count > 0 %}
                    {% blocktrans count item_count=item_count %}{{ item_count }} item{% plural %}{{ item_count }} items{% endblocktrans %}
                {% endif %}
            </nobr>
        {% endwith %}

        {% if topic.status == "draft" %}
            <span class="badge bg-warning  pill ms-1">{% trans "Draft" %}</span>
        {% endif %}

    </p>

    <div class="position-relative">

        <a href="{{ topic.get_absolute_url }}" class="stretched-link"></a>

        {% if topic.thumbnail %}
            <img src="{{ topic.thumbnail.url }}" alt="{{ topic.title }}" class="img-fluid rounded mb-2 float-start me-3 w-50">
        {% endif %}

        {% with topic.recaps.last as latest_recap %}
            {% if latest_recap %}
                <div class="small text-body">{{ latest_recap.recap|markdownify }}</div>
            {% endif %}
        {% endwith %}

    </div>

</div>
