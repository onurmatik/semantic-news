{% load i18n %}
{% with has_links=related_topic_links|length %}
<div class="mt-3{% if edit_mode %} card{% endif %}" data-related-topics-card>
  {% if edit_mode %}
  <div class="card-header d-flex align-items-center">
    <h6 class="fs-5 mb-0">{% trans "Related topics" %}</h6>
    <div class="d-flex align-items-center gap-2 ms-auto" data-topic-module-header-actions></div>
  </div>
  {% else %}
    <h6 class="fs-5 mb-2">{% trans "Related topics" %}</h6>
  {% endif %}
  <div{% if edit_mode %} class="card-body"{% endif %} data-related-topic-list data-empty-message="{% trans 'No related topics yet.' %}">
    {% if has_links %}
      <ul class="list-unstyled mb-0" data-related-topic-items>
        {% for link in related_topic_links %}
          {% with topic_obj=link.related_topic %}
          <li class="mb-2" data-related-topic-link data-link-id="{{ link.id }}">
            <div class="d-flex align-items-start justify-content-between">
              <div>
                {% if topic_obj.slug and topic_obj.created_by and topic_obj.created_by.username %}
                  <a href="{% url 'topics_detail' slug=topic_obj.slug username=topic_obj.created_by.username %}" class="fw-semibold text-decoration-none">
                    {{ topic_obj.title|default:_('Untitled topic') }}
                  </a>
                {% else %}
                  <span class="fw-semibold">{{ topic_obj.title|default:_('Untitled topic') }}</span>
                {% endif %}
                <div class="text-secondary small">
                  {% if topic_obj.created_by and topic_obj.created_by.username %}
                    {% blocktrans with username=topic_obj.created_by.username %}By {{ username }}{% endblocktrans %}
                  {% endif %}
                  {% if link.source %}
                    <span class="badge bg-light text-dark border ms-1">
                      {% if link.source == 'auto' %}
                        {% trans "Automatic" %}
                      {% elif link.source == 'manual' %}
                        {% trans "Manual" %}
                      {% else %}
                        {{ link.source|capfirst }}
                      {% endif %}
                    </span>
                  {% endif %}
                </div>
              </div>
            </div>
          </li>
          {% endwith %}
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-secondary small mb-0">{% trans "No related topics yet." %}</p>
    {% endif %}
  </div>
</div>
{% endwith %}
